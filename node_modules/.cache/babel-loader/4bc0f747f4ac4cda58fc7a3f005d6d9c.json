{"ast":null,"code":"import MediaDevice from './MediaDevice';\nimport Emitter from './Emitter';\nimport socket from './socket';\nwindow.moz = !!navigator.mozGetUserMedia;\nvar chromeVersion = !!navigator.mozGetUserMedia ? 0 : parseInt(navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)[2]);\nlet moz = window.moz;\nvar iceServers = [];\n\nif (moz) {\n  iceServers.push({\n    url: 'stun:23.21.150.121'\n  });\n  iceServers.push({\n    url: 'stun:stun.services.mozilla.com'\n  });\n}\n\nif (!moz) {\n  iceServers.push({\n    url: 'stun:stun.l.google.com:19302'\n  });\n  iceServers.push({\n    url: 'stun:stun.anyfirewall.com:3478'\n  });\n}\n\nif (!moz && chromeVersion < 28) {\n  iceServers.push({\n    url: 'turn:homeo@turn.bistri.com:80',\n    credential: 'homeo'\n  });\n}\n\nif (!moz && chromeVersion >= 28) {\n  iceServers.push({\n    url: 'turn:turn.bistri.com:80',\n    credential: 'homeo',\n    username: 'homeo'\n  });\n  iceServers.push({\n    url: 'turn:turn.anyfirewall.com:443?transport=tcp',\n    credential: 'webrtc',\n    username: 'webrtc'\n  });\n}\n\nconst PC_CONFIG = {\n  iceServers: iceServers\n}; // [{ urls: ['stun:stun.l.google.com:19302'] }] };\n\nclass PeerConnection extends Emitter {\n  /**\r\n     * Create a PeerConnection.\r\n     * @param {String} friendID - ID of the friend you want to call.\r\n     */\n  constructor(friendID) {\n    super();\n    this.pc = new RTCPeerConnection(PC_CONFIG);\n\n    this.pc.onicecandidate = event => socket.emit('call', {\n      to: this.friendID,\n      candidate: event.candidate\n    });\n\n    this.pc.onaddstream = event => this.emit('peerStream', event.stream);\n\n    this.mediaDevice = new MediaDevice();\n    this.friendID = friendID;\n  }\n  /**\r\n   * Starting the call\r\n   * @param {Boolean} isCaller\r\n   * @param {Object} config - configuration for the call {audio: boolean, video: boolean}\r\n   */\n\n\n  start(isCaller, config) {\n    this.mediaDevice.on('stream', stream => {\n      this.pc.addStream(stream);\n      this.emit('localStream', stream);\n      if (isCaller) socket.emit('request', {\n        to: this.friendID\n      });else this.createOffer();\n    }).start(config);\n    return this;\n  }\n  /**\r\n   * Stop the call\r\n   * @param {Boolean} isStarter\r\n   */\n\n\n  stop(isStarter) {\n    if (isStarter) socket.emit('end', {\n      to: this.friendID\n    });\n    this.mediaDevice.stop();\n    this.pc.close();\n    this.pc = null;\n    this.off();\n    return this;\n  }\n\n  createOffer() {\n    this.pc.createOffer().then(this.getDescription.bind(this)).catch(err => console.log(err));\n    return this;\n  }\n\n  createAnswer() {\n    this.pc.createAnswer().then(this.getDescription.bind(this)).catch(err => console.log(err));\n    return this;\n  }\n\n  getDescription(desc) {\n    console.log('desc - - ', desc);\n    this.pc.setLocalDescription(desc);\n    socket.emit('call', {\n      to: this.friendID,\n      sdp: desc\n    });\n    return this;\n  }\n  /**\r\n   * @param {Object} sdp - Session description\r\n   */\n\n\n  setRemoteDescription(sdp) {\n    const rtcSdp = new RTCSessionDescription(sdp);\n    this.pc.setRemoteDescription(rtcSdp);\n    return this;\n  }\n  /**\r\n   * @param {Object} candidate - ICE Candidate\r\n   */\n\n\n  addIceCandidate(candidate) {\n    if (candidate) {\n      const iceCandidate = new RTCIceCandidate(candidate);\n      this.pc.addIceCandidate(iceCandidate);\n    }\n\n    return this;\n  }\n\n}\n\nexport default PeerConnection;","map":{"version":3,"sources":["C:\\Users\\Ankur\\Desktop\\therapidhire\\therapidhireui\\TheRapidHireUI\\src\\videoChat\\js\\PeerConnection.js"],"names":["MediaDevice","Emitter","socket","window","moz","navigator","mozGetUserMedia","chromeVersion","parseInt","userAgent","match","iceServers","push","url","credential","username","PC_CONFIG","PeerConnection","constructor","friendID","pc","RTCPeerConnection","onicecandidate","event","emit","to","candidate","onaddstream","stream","mediaDevice","start","isCaller","config","on","addStream","createOffer","stop","isStarter","close","off","then","getDescription","bind","catch","err","console","log","createAnswer","desc","setLocalDescription","sdp","setRemoteDescription","rtcSdp","RTCSessionDescription","addIceCandidate","iceCandidate","RTCIceCandidate"],"mappings":"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","sourcesContent":["import MediaDevice from './MediaDevice';\r\nimport Emitter from './Emitter';\r\nimport socket from './socket';\r\n\r\nwindow.moz = !!navigator.mozGetUserMedia;\r\nvar chromeVersion = !!navigator.mozGetUserMedia ? 0 : parseInt(navigator.userAgent.match( /Chrom(e|ium)\\/([0-9]+)\\./ )[2]);\r\nlet moz= window.moz;\r\nvar iceServers = [];\r\n\r\n    if (moz) {\r\n        iceServers.push({\r\n            url: 'stun:23.21.150.121'\r\n        });\r\n\r\n        iceServers.push({\r\n            url: 'stun:stun.services.mozilla.com'\r\n        });\r\n    }\r\n\r\n    if (!moz) {\r\n        iceServers.push({\r\n            url: 'stun:stun.l.google.com:19302'\r\n        });\r\n\r\n        iceServers.push({\r\n            url: 'stun:stun.anyfirewall.com:3478'\r\n        });\r\n    }\r\n\r\n    if (!moz && chromeVersion < 28) {\r\n        iceServers.push({\r\n            url: 'turn:homeo@turn.bistri.com:80',\r\n            credential: 'homeo'\r\n        });\r\n    }\r\n\r\n    if (!moz && chromeVersion >= 28) {\r\n        iceServers.push({\r\n            url: 'turn:turn.bistri.com:80',\r\n            credential: 'homeo',\r\n            username: 'homeo'\r\n        });\r\n\r\n        iceServers.push({\r\n            url: 'turn:turn.anyfirewall.com:443?transport=tcp',\r\n            credential: 'webrtc',\r\n            username: 'webrtc'\r\n        });\r\n    }\r\n\r\nconst PC_CONFIG = { iceServers: iceServers };// [{ urls: ['stun:stun.l.google.com:19302'] }] };\r\n\r\nclass PeerConnection extends Emitter {\r\n  /**\r\n     * Create a PeerConnection.\r\n     * @param {String} friendID - ID of the friend you want to call.\r\n     */\r\n  constructor(friendID) {\r\n    super();\r\n    this.pc = new RTCPeerConnection(PC_CONFIG);\r\n    this.pc.onicecandidate = event => socket.emit('call', {\r\n      to: this.friendID,\r\n      candidate: event.candidate\r\n    });\r\n    this.pc.onaddstream = event => this.emit('peerStream', event.stream);\r\n\r\n    this.mediaDevice = new MediaDevice();\r\n    this.friendID = friendID;\r\n  }\r\n\r\n  /**\r\n   * Starting the call\r\n   * @param {Boolean} isCaller\r\n   * @param {Object} config - configuration for the call {audio: boolean, video: boolean}\r\n   */\r\n  start(isCaller, config) {\r\n    this.mediaDevice\r\n      .on('stream', (stream) => {\r\n        this.pc.addStream(stream);\r\n        this.emit('localStream', stream);\r\n        if (isCaller) socket.emit('request', { to: this.friendID });\r\n        else this.createOffer();\r\n      })\r\n      .start(config);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stop the call\r\n   * @param {Boolean} isStarter\r\n   */\r\n  stop(isStarter) {\r\n    if (isStarter) socket.emit('end', { to: this.friendID });\r\n    this.mediaDevice.stop();\r\n    this.pc.close();\r\n    this.pc = null;\r\n    this.off();\r\n    return this;\r\n  }\r\n\r\n  createOffer() {\r\n    this.pc.createOffer()\r\n      .then(this.getDescription.bind(this))\r\n      .catch(err => console.log(err));\r\n    return this;\r\n  }\r\n\r\n  createAnswer() {\r\n    this.pc.createAnswer()\r\n      .then(this.getDescription.bind(this))\r\n      .catch(err => console.log(err));\r\n    return this;\r\n  }\r\n\r\n  getDescription(desc) {\r\n    console.log('desc - - ',desc);\r\n    this.pc.setLocalDescription(desc);\r\n    socket.emit('call', { to: this.friendID, sdp: desc });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} sdp - Session description\r\n   */\r\n  setRemoteDescription(sdp) {\r\n    const rtcSdp = new RTCSessionDescription(sdp);\r\n    this.pc.setRemoteDescription(rtcSdp);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} candidate - ICE Candidate\r\n   */\r\n  addIceCandidate(candidate) {\r\n    if (candidate) {\r\n      const iceCandidate = new RTCIceCandidate(candidate);\r\n      this.pc.addIceCandidate(iceCandidate);\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport default PeerConnection;\r\n"]},"metadata":{},"sourceType":"module"}