{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\Ankur\\\\Desktop\\\\therapidhire\\\\therapidhireui\\\\TheRapidHireUI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Ankur\\\\Desktop\\\\therapidhire\\\\therapidhireui\\\\TheRapidHireUI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\Ankur\\\\Desktop\\\\therapidhire\\\\therapidhireui\\\\TheRapidHireUI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\Ankur\\\\Desktop\\\\therapidhire\\\\therapidhireui\\\\TheRapidHireUI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\Ankur\\\\Desktop\\\\therapidhire\\\\therapidhireui\\\\TheRapidHireUI\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import MediaDevice from'./MediaDevice';import Emitter from'./Emitter';import socket from'./socket';window.moz=!!navigator.mozGetUserMedia;var chromeVersion=!!navigator.mozGetUserMedia?0:parseInt(navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)[2]);var moz=window.moz;var iceServers=[];if(moz){iceServers.push({url:'stun:23.21.150.121'});iceServers.push({url:'stun:stun.services.mozilla.com'});}if(!moz){iceServers.push({url:'stun:stun.l.google.com:19302'});iceServers.push({url:'stun:stun.anyfirewall.com:3478'});}if(!moz&&chromeVersion<28){iceServers.push({url:'turn:homeo@turn.bistri.com:80',credential:'homeo'});}if(!moz&&chromeVersion>=28){iceServers.push({url:'turn:turn.bistri.com:80',credential:'homeo',username:'homeo'});iceServers.push({url:'turn:turn.anyfirewall.com:443?transport=tcp',credential:'webrtc',username:'webrtc'});}var PC_CONFIG={iceServers:iceServers};// [{ urls: ['stun:stun.l.google.com:19302'] }] };\nvar PeerConnection=/*#__PURE__*/function(_Emitter){_inherits(PeerConnection,_Emitter);/**\r\n   * Create a PeerConnection.\r\n   * @param {String} friendID - ID of the friend you want to call.\r\n   */function PeerConnection(friendID){var _this;_classCallCheck(this,PeerConnection);_this=_possibleConstructorReturn(this,_getPrototypeOf(PeerConnection).call(this));_this.pc=new RTCPeerConnection(PC_CONFIG);console.log('constructor ',_this.friendID);_this.pc.onicecandidate=function(event){return socket.emit('call',{to:_this.friendID,candidate:event.candidate});};_this.pc.onaddstream=function(event){return _this.emit('peerStream',event.stream);};_this.mediaDevice=new MediaDevice();_this.friendID=friendID;return _this;}/**\r\n   * Starting the call\r\n   * @param {Boolean} isCaller\r\n   * @param {Object} config - configuration for the call {audio: boolean, video: boolean}\r\n   */_createClass(PeerConnection,[{key:\"start\",value:function start(isCaller,config){var _this2=this;console.log('start  call');this.mediaDevice.on('stream',function(stream){_this2.pc.addStream(stream);_this2.emit('localStream',stream);if(isCaller)socket.emit('request',{to:_this2.friendID});else _this2.createOffer();}).start(config);return this;}/**\r\n   * Stop the call\r\n   * @param {Boolean} isStarter\r\n   */},{key:\"stop\",value:function stop(isStarter){if(isStarter)socket.emit('end',{to:this.friendID});this.mediaDevice.stop();this.pc.close();this.pc=null;this.off();return this;}},{key:\"createOffer\",value:function createOffer(){this.pc.createOffer().then(this.getDescription.bind(this)).catch(function(err){return console.log(err);});return this;}},{key:\"createAnswer\",value:function createAnswer(){this.pc.createAnswer().then(this.getDescription.bind(this)).catch(function(err){return console.log(err);});return this;}},{key:\"getDescription\",value:function getDescription(desc){console.log('desc - - ',desc);this.pc.setLocalDescription(desc);socket.emit('call',{to:this.friendID,sdp:desc});return this;}/**\r\n   * @param {Object} sdp - Session description\r\n   */},{key:\"setRemoteDescription\",value:function setRemoteDescription(sdp){var rtcSdp=new RTCSessionDescription(sdp);this.pc.setRemoteDescription(rtcSdp);return this;}/**\r\n   * @param {Object} candidate - ICE Candidate\r\n   */},{key:\"addIceCandidate\",value:function addIceCandidate(candidate){if(candidate){var iceCandidate=new RTCIceCandidate(candidate);this.pc.addIceCandidate(iceCandidate);}return this;}}]);return PeerConnection;}(Emitter);export default PeerConnection;","map":{"version":3,"sources":["C:\\Users\\Ankur\\Desktop\\therapidhire\\therapidhireui\\TheRapidHireUI\\src\\videoChat\\js\\PeerConnection.js"],"names":["MediaDevice","Emitter","socket","window","moz","navigator","mozGetUserMedia","chromeVersion","parseInt","userAgent","match","iceServers","push","url","credential","username","PC_CONFIG","PeerConnection","friendID","pc","RTCPeerConnection","console","log","onicecandidate","event","emit","to","candidate","onaddstream","stream","mediaDevice","isCaller","config","on","addStream","createOffer","start","isStarter","stop","close","off","then","getDescription","bind","catch","err","createAnswer","desc","setLocalDescription","sdp","rtcSdp","RTCSessionDescription","setRemoteDescription","iceCandidate","RTCIceCandidate","addIceCandidate"],"mappings":"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","sourcesContent":["import MediaDevice from './MediaDevice';\r\nimport Emitter from './Emitter';\r\nimport socket from './socket';\r\n\r\nwindow.moz = !!navigator.mozGetUserMedia;\r\nvar chromeVersion = !!navigator.mozGetUserMedia\r\n  ? 0\r\n  : parseInt(navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)[2]);\r\nlet moz = window.moz;\r\nvar iceServers = [];\r\n\r\nif (moz) {\r\n  iceServers.push({\r\n    url: 'stun:23.21.150.121'\r\n  });\r\n\r\n  iceServers.push({\r\n    url: 'stun:stun.services.mozilla.com'\r\n  });\r\n}\r\n\r\nif (!moz) {\r\n  iceServers.push({\r\n    url: 'stun:stun.l.google.com:19302'\r\n  });\r\n\r\n  iceServers.push({\r\n    url: 'stun:stun.anyfirewall.com:3478'\r\n  });\r\n}\r\n\r\nif (!moz && chromeVersion < 28) {\r\n  iceServers.push({\r\n    url: 'turn:homeo@turn.bistri.com:80',\r\n    credential: 'homeo'\r\n  });\r\n}\r\n\r\nif (!moz && chromeVersion >= 28) {\r\n  iceServers.push({\r\n    url: 'turn:turn.bistri.com:80',\r\n    credential: 'homeo',\r\n    username: 'homeo'\r\n  });\r\n\r\n  iceServers.push({\r\n    url: 'turn:turn.anyfirewall.com:443?transport=tcp',\r\n    credential: 'webrtc',\r\n    username: 'webrtc'\r\n  });\r\n}\r\n\r\nconst PC_CONFIG = { iceServers: iceServers }; // [{ urls: ['stun:stun.l.google.com:19302'] }] };\r\n\r\nclass PeerConnection extends Emitter {\r\n  /**\r\n   * Create a PeerConnection.\r\n   * @param {String} friendID - ID of the friend you want to call.\r\n   */\r\n  constructor(friendID) {\r\n    super();\r\n    this.pc = new RTCPeerConnection(PC_CONFIG);\r\n\r\n    console.log('constructor ', this.friendID);\r\n\r\n    this.pc.onicecandidate = event =>\r\n      socket.emit('call', {\r\n        to: this.friendID,\r\n        candidate: event.candidate\r\n      });\r\n    this.pc.onaddstream = event => this.emit('peerStream', event.stream);\r\n\r\n    this.mediaDevice = new MediaDevice();\r\n    this.friendID = friendID;\r\n  }\r\n\r\n  /**\r\n   * Starting the call\r\n   * @param {Boolean} isCaller\r\n   * @param {Object} config - configuration for the call {audio: boolean, video: boolean}\r\n   */\r\n  start(isCaller, config) {\r\n    console.log('start  call');\r\n    this.mediaDevice\r\n      .on('stream', stream => {\r\n        this.pc.addStream(stream);\r\n        this.emit('localStream', stream);\r\n        if (isCaller) socket.emit('request', { to: this.friendID });\r\n        else this.createOffer();\r\n      })\r\n      .start(config);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stop the call\r\n   * @param {Boolean} isStarter\r\n   */\r\n  stop(isStarter) {\r\n    if (isStarter) socket.emit('end', { to: this.friendID });\r\n    this.mediaDevice.stop();\r\n    this.pc.close();\r\n    this.pc = null;\r\n    this.off();\r\n    return this;\r\n  }\r\n\r\n  createOffer() {\r\n    this.pc\r\n      .createOffer()\r\n      .then(this.getDescription.bind(this))\r\n      .catch(err => console.log(err));\r\n    return this;\r\n  }\r\n\r\n  createAnswer() {\r\n    this.pc\r\n      .createAnswer()\r\n      .then(this.getDescription.bind(this))\r\n      .catch(err => console.log(err));\r\n    return this;\r\n  }\r\n\r\n  getDescription(desc) {\r\n    console.log('desc - - ', desc);\r\n    this.pc.setLocalDescription(desc);\r\n    socket.emit('call', { to: this.friendID, sdp: desc });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} sdp - Session description\r\n   */\r\n  setRemoteDescription(sdp) {\r\n    const rtcSdp = new RTCSessionDescription(sdp);\r\n    this.pc.setRemoteDescription(rtcSdp);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} candidate - ICE Candidate\r\n   */\r\n  addIceCandidate(candidate) {\r\n    if (candidate) {\r\n      const iceCandidate = new RTCIceCandidate(candidate);\r\n      this.pc.addIceCandidate(iceCandidate);\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport default PeerConnection;\r\n"]},"metadata":{},"sourceType":"module"}