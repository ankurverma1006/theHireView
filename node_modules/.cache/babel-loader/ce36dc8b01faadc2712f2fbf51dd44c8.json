{"ast":null,"code":"import _classCallCheck from\"/home/ank/Desktop/therapidhiregit/therapidhireui/TheRapidHireUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ank/Desktop/therapidhiregit/therapidhireui/TheRapidHireUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/ank/Desktop/therapidhiregit/therapidhireui/TheRapidHireUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/ank/Desktop/therapidhiregit/therapidhireui/TheRapidHireUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/ank/Desktop/therapidhiregit/therapidhireui/TheRapidHireUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import MediaDevice from'./MediaDevice';import Emitter from'./Emitter';import socket from'./socket';window.moz=!!navigator.mozGetUserMedia;var chromeVersion=!!navigator.mozGetUserMedia?0:parseInt(navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)[2]);var moz=window.moz;var iceServers=[];if(moz){iceServers.push({url:'stun:23.21.150.121'});iceServers.push({url:'stun:stun.services.mozilla.com'});}if(!moz){iceServers.push({url:'stun:stun.l.google.com:19302'});iceServers.push({url:'stun:stun.anyfirewall.com:3478'});}if(!moz&&chromeVersion<28){iceServers.push({url:'turn:homeo@turn.bistri.com:80',credential:'homeo'});}if(!moz&&chromeVersion>=28){iceServers.push({url:'turn:turn.bistri.com:80',credential:'homeo',username:'homeo'});iceServers.push({url:'turn:turn.anyfirewall.com:443?transport=tcp',credential:'webrtc',username:'webrtc'});}var PC_CONFIG={iceServers:iceServers};// [{ urls: ['stun:stun.l.google.com:19302'] }] };\nvar PeerConnection=/*#__PURE__*/function(_Emitter){_inherits(PeerConnection,_Emitter);/**\n     * Create a PeerConnection.\n     * @param {String} friendID - ID of the friend you want to call.\n     */function PeerConnection(friendID){var _this;_classCallCheck(this,PeerConnection);_this=_possibleConstructorReturn(this,_getPrototypeOf(PeerConnection).call(this));_this.pc=new RTCPeerConnection(PC_CONFIG);_this.pc.onicecandidate=function(event){return socket.emit('call',{to:_this.friendID,candidate:event.candidate});};_this.pc.onaddstream=function(event){return _this.emit('peerStream',event.stream);};_this.mediaDevice=new MediaDevice();_this.friendID=friendID;return _this;}/**\n   * Starting the call\n   * @param {Boolean} isCaller\n   * @param {Object} config - configuration for the call {audio: boolean, video: boolean}\n   */_createClass(PeerConnection,[{key:\"start\",value:function start(isCaller,config){var _this2=this;this.mediaDevice.on('stream',function(stream){_this2.pc.addStream(stream);_this2.emit('localStream',stream);if(isCaller)socket.emit('request',{to:_this2.friendID});else _this2.createOffer();}).start(config);return this;}/**\n   * Stop the call\n   * @param {Boolean} isStarter\n   */},{key:\"stop\",value:function stop(isStarter){if(isStarter)socket.emit('end',{to:this.friendID});this.mediaDevice.stop();this.pc.close();this.pc=null;this.off();return this;}},{key:\"createOffer\",value:function createOffer(){this.pc.createOffer().then(this.getDescription.bind(this)).catch(function(err){return console.log(err);});return this;}},{key:\"createAnswer\",value:function createAnswer(){this.pc.createAnswer().then(this.getDescription.bind(this)).catch(function(err){return console.log(err);});return this;}},{key:\"getDescription\",value:function getDescription(desc){console.log('desc - - ',desc);this.pc.setLocalDescription(desc);socket.emit('call',{to:this.friendID,sdp:desc});return this;}/**\n   * @param {Object} sdp - Session description\n   */},{key:\"setRemoteDescription\",value:function setRemoteDescription(sdp){var rtcSdp=new RTCSessionDescription(sdp);this.pc.setRemoteDescription(rtcSdp);return this;}/**\n   * @param {Object} candidate - ICE Candidate\n   */},{key:\"addIceCandidate\",value:function addIceCandidate(candidate){if(candidate){var iceCandidate=new RTCIceCandidate(candidate);this.pc.addIceCandidate(iceCandidate);}return this;}}]);return PeerConnection;}(Emitter);export default PeerConnection;","map":{"version":3,"sources":["/home/ank/Desktop/therapidhiregit/therapidhireui/TheRapidHireUI/src/videoChat/js/PeerConnection.js"],"names":["MediaDevice","Emitter","socket","window","moz","navigator","mozGetUserMedia","chromeVersion","parseInt","userAgent","match","iceServers","push","url","credential","username","PC_CONFIG","PeerConnection","friendID","pc","RTCPeerConnection","onicecandidate","event","emit","to","candidate","onaddstream","stream","mediaDevice","isCaller","config","on","addStream","createOffer","start","isStarter","stop","close","off","then","getDescription","bind","catch","err","console","log","createAnswer","desc","setLocalDescription","sdp","rtcSdp","RTCSessionDescription","setRemoteDescription","iceCandidate","RTCIceCandidate","addIceCandidate"],"mappings":"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","sourcesContent":["import MediaDevice from './MediaDevice';\nimport Emitter from './Emitter';\nimport socket from './socket';\n\nwindow.moz = !!navigator.mozGetUserMedia;\nvar chromeVersion = !!navigator.mozGetUserMedia ? 0 : parseInt(navigator.userAgent.match( /Chrom(e|ium)\\/([0-9]+)\\./ )[2]);\nlet moz= window.moz;\nvar iceServers = [];\n\n    if (moz) {\n        iceServers.push({\n            url: 'stun:23.21.150.121'\n        });\n\n        iceServers.push({\n            url: 'stun:stun.services.mozilla.com'\n        });\n    }\n\n    if (!moz) {\n        iceServers.push({\n            url: 'stun:stun.l.google.com:19302'\n        });\n\n        iceServers.push({\n            url: 'stun:stun.anyfirewall.com:3478'\n        });\n    }\n\n    if (!moz && chromeVersion < 28) {\n        iceServers.push({\n            url: 'turn:homeo@turn.bistri.com:80',\n            credential: 'homeo'\n        });\n    }\n\n    if (!moz && chromeVersion >= 28) {\n        iceServers.push({\n            url: 'turn:turn.bistri.com:80',\n            credential: 'homeo',\n            username: 'homeo'\n        });\n\n        iceServers.push({\n            url: 'turn:turn.anyfirewall.com:443?transport=tcp',\n            credential: 'webrtc',\n            username: 'webrtc'\n        });\n    }\n\nconst PC_CONFIG = { iceServers: iceServers };// [{ urls: ['stun:stun.l.google.com:19302'] }] };\n\nclass PeerConnection extends Emitter {\n  /**\n     * Create a PeerConnection.\n     * @param {String} friendID - ID of the friend you want to call.\n     */\n  constructor(friendID) {\n    super();\n    this.pc = new RTCPeerConnection(PC_CONFIG);\n    this.pc.onicecandidate = event => socket.emit('call', {\n      to: this.friendID,\n      candidate: event.candidate\n    });\n    this.pc.onaddstream = event => this.emit('peerStream', event.stream);\n\n    this.mediaDevice = new MediaDevice();\n    this.friendID = friendID;\n  }\n\n  /**\n   * Starting the call\n   * @param {Boolean} isCaller\n   * @param {Object} config - configuration for the call {audio: boolean, video: boolean}\n   */\n  start(isCaller, config) {\n    this.mediaDevice\n      .on('stream', (stream) => {\n        this.pc.addStream(stream);\n        this.emit('localStream', stream);\n        if (isCaller) socket.emit('request', { to: this.friendID });\n        else this.createOffer();\n      })\n      .start(config);\n\n    return this;\n  }\n\n  /**\n   * Stop the call\n   * @param {Boolean} isStarter\n   */\n  stop(isStarter) {\n    if (isStarter) socket.emit('end', { to: this.friendID });\n    this.mediaDevice.stop();\n    this.pc.close();\n    this.pc = null;\n    this.off();\n    return this;\n  }\n\n  createOffer() {\n    this.pc.createOffer()\n      .then(this.getDescription.bind(this))\n      .catch(err => console.log(err));\n    return this;\n  }\n\n  createAnswer() {\n    this.pc.createAnswer()\n      .then(this.getDescription.bind(this))\n      .catch(err => console.log(err));\n    return this;\n  }\n\n  getDescription(desc) {\n    console.log('desc - - ',desc);\n    this.pc.setLocalDescription(desc);\n    socket.emit('call', { to: this.friendID, sdp: desc });\n    return this;\n  }\n\n  /**\n   * @param {Object} sdp - Session description\n   */\n  setRemoteDescription(sdp) {\n    const rtcSdp = new RTCSessionDescription(sdp);\n    this.pc.setRemoteDescription(rtcSdp);\n    return this;\n  }\n\n  /**\n   * @param {Object} candidate - ICE Candidate\n   */\n  addIceCandidate(candidate) {\n    if (candidate) {\n      const iceCandidate = new RTCIceCandidate(candidate);\n      this.pc.addIceCandidate(iceCandidate);\n    }\n    return this;\n  }\n}\n\nexport default PeerConnection;\n"]},"metadata":{},"sourceType":"module"}